<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<StackPane xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="tw.ntou.pettracker.MainController"
           styleClass="app-container">
  <children>
    <!-- åŽŸæœ¬çš„ BorderPane ä¸»é«” -->
    <BorderPane styleClass="app-container">

      <!-- é ‚éƒ¨æ¨™é¡Œæ¬„å’Œå°Žèˆª -->
      <top>
        <VBox>
          <HBox styleClass="header-bar" alignment="CENTER_LEFT">
            <padding>
              <Insets top="16" right="24" bottom="16" left="24"/>
            </padding>

            <Label text="ðŸ± Pet Habit Tracker" styleClass="app-title"/>
            <Region HBox.hgrow="ALWAYS"/>

            <HBox styleClass="progress-display" spacing="16" alignment="CENTER">
              <Label text="ä»Šæ—¥:" styleClass="progress-label"/>
              <Label fx:id="dailyProgressLabel" text="0/5" styleClass="progress-value"/>
              <Label text="æœ¬æœˆ:" styleClass="progress-label"/>
              <Label fx:id="monthlyProgressLabel" text="0/30" styleClass="progress-value"/>
            </HBox>

            <Region HBox.hgrow="ALWAYS"/>

            <HBox spacing="8">
              <Label fx:id="streakLabel" text="ðŸ”¥ 0 å¤©" styleClass="streak-label"/>

              <Button fx:id="themeButton" text="ðŸŽ¨" styleClass="icon-button">
                <tooltip><Tooltip text="åˆ‡æ›ä¸»é¡Œ"/></tooltip>
              </Button>
              <Button fx:id="statsButton" text="ðŸ“Š" styleClass="icon-button">
                <tooltip><Tooltip text="çµ±è¨ˆå ±å‘Š"/></tooltip>
              </Button>
              <Button fx:id="achievementButton" text="ðŸ†" styleClass="icon-button">
                <tooltip><Tooltip text="æˆå°±ç³»çµ±"/></tooltip>
              </Button>
              <Button fx:id="settingsBtn" text="âš™ï¸" styleClass="icon-button">
                <tooltip><Tooltip text="è¨­å®š"/></tooltip>
              </Button>
            </HBox>
          </HBox>

          <HBox styleClass="view-tabs" spacing="0">
            <padding>
              <Insets top="0" right="24" bottom="0" left="24"/>
            </padding>
            <ToggleButton fx:id="todayTab" text="ðŸ“… ä»Šæ—¥" styleClass="view-tab" selected="true"/>
            <ToggleButton fx:id="upcomingTab" text="ðŸ“‹ å³å°‡åˆ°ä¾†" styleClass="view-tab"/>
            <ToggleButton fx:id="allTab" text="ðŸ“ å…¨éƒ¨" styleClass="view-tab"/>
          </HBox>
        </VBox>
      </top>

      <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
      <center>
        <HBox spacing="0">
          <VBox styleClass="main-content" HBox.hgrow="ALWAYS">

            <HBox fx:id="inputBar" styleClass="quick-add-bar" spacing="12" alignment="CENTER_LEFT"
                  visible="true" managed="true">
              <padding><Insets top="16" right="24" bottom="16" left="24"/></padding>
              <TextField fx:id="descField"
                         promptText="âž• å¿«é€Ÿæ–°å¢žä»»å‹™... (ä¾‹: æ˜Žå¤© é‹å‹• 30åˆ†é˜)"
                         styleClass="quick-add-input"
                         onAction="#onAddTask"
                         HBox.hgrow="ALWAYS"/>
              <DatePicker fx:id="datePicker" styleClass="date-picker"/>
              <ComboBox fx:id="prioBox" styleClass="priority-combo" prefWidth="100"/>
              <ComboBox fx:id="categoryFilter" styleClass="category-combo"
                        promptText="é¸æ“‡é¡žåˆ¥" prefWidth="120"/>
              <Button text="âž• æ–°å¢ž" styleClass="add-button" onAction="#onAddTask"/>
            </HBox>

            <HBox styleClass="search-filter-bar" spacing="12" alignment="CENTER_LEFT">
              <padding><Insets top="12" right="24" bottom="12" left="24"/></padding>
              <TextField fx:id="searchField"
                         promptText="ðŸ” æœç´¢ä»»å‹™..."
                         styleClass="search-input"
                         prefWidth="200"/>
              <ComboBox fx:id="filterPriorityBox" promptText="å„ªå…ˆç´šç¯©é¸"
                        styleClass="filter-combo" prefWidth="120"/>
              <ComboBox fx:id="filterStatusBox" promptText="ç‹€æ…‹ç¯©é¸"
                        styleClass="filter-combo" prefWidth="100"/>
              <Button fx:id="clearFiltersBtn" text="ðŸ—‘ï¸ æ¸…é™¤ç¯©é¸"
                      styleClass="clear-filter-btn" onAction="#onClearFilters"/>
              <Region HBox.hgrow="ALWAYS"/>
              <Button fx:id="batchCompleteBtn" text="âœ… æ‰¹é‡å®Œæˆ"
                      styleClass="batch-btn" visible="false" onAction="#onBatchComplete"/>
              <Button fx:id="batchDeleteBtn" text="ðŸ—‘ï¸ æ‰¹é‡åˆªé™¤"
                      styleClass="batch-btn-danger" visible="false" onAction="#onBatchDelete"/>
              <Label text="æŽ’åº:" styleClass="sort-label"/>
              <ComboBox fx:id="sortBox" styleClass="sort-combo" prefWidth="150"/>
            </HBox>

            <ScrollPane styleClass="task-scroll-pane" fitToWidth="true" VBox.vgrow="ALWAYS">
              <content>
                <TableView fx:id="table" styleClass="task-table" editable="true">
                  <columns>
                    <TableColumn fx:id="doneCol" text="âœ“" prefWidth="50"
                                 resizable="false" styleClass="done-column"/>
                    <TableColumn fx:id="descCol" text="ä»»å‹™æè¿°" prefWidth="280"
                                 styleClass="desc-column"/>
                    <TableColumn fx:id="dateCol" text="åˆ°æœŸæ—¥" prefWidth="100"
                                 styleClass="date-column"/>
                    <TableColumn fx:id="prioCol" text="å„ªå…ˆç´š" prefWidth="80"
                                 styleClass="priority-column"/>
                    <TableColumn fx:id="categoryCol" text="é¡žåˆ¥" prefWidth="100"
                                 styleClass="category-column"/>
                    <TableColumn fx:id="deleteCol" text="æ“ä½œ" prefWidth="80"
                                 resizable="false" styleClass="action-column"/>
                  </columns>
                  <placeholder>
                    <Label text="æš«ç„¡ä»»å‹™ï¼Œé»žæ“Šä¸Šæ–¹è¼¸å…¥æ¡†æ–°å¢žç¬¬ä¸€å€‹ä»»å‹™å§ï¼"
                           styleClass="empty-placeholder"/>
                  </placeholder>
                </TableView>
              </content>
            </ScrollPane>

          </VBox>

          <VBox fx:id="petPanel" styleClass="pet-sidebar" spacing="16">
            <padding><Insets top="24" right="24" bottom="24" left="24"/></padding>

            <VBox styleClass="pet-avatar-section" spacing="12" alignment="CENTER">
              <ImageView fx:id="petImage" fitWidth="120" fitHeight="120"
                         preserveRatio="true" styleClass="pet-avatar"/>
              <Label text="å°è²“å’ª" styleClass="pet-name"/>
              <Label text="Lv.1" styleClass="pet-level"/>
            </VBox>

            <VBox styleClass="pet-stats" spacing="16">
              <VBox spacing="8">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ’–" styleClass="stat-icon"/>
                  <Label text="æ»¿æ„åº¦" styleClass="stat-label"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="satisfactionLabel" text="80%" styleClass="stat-value"/>
                </HBox>
                <ProgressBar fx:id="satisfactionBar" prefWidth="200"
                             progress="0.8" styleClass="satisfaction-bar"/>
              </VBox>
              <VBox spacing="8">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ–" styleClass="stat-icon"/>
                  <Label text="é£½é£Ÿåº¦" styleClass="stat-label"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="fullnessLabel" text="60%" styleClass="stat-value"/>
                </HBox>
                <ProgressBar fx:id="fullnessBar" prefWidth="200"
                             progress="0.6" styleClass="fullness-bar"/>
              </VBox>
            </VBox>

            <VBox styleClass="task-stats" spacing="12">
              <Label text="ðŸ“Š ä»»å‹™çµ±è¨ˆ" styleClass="section-title"/>
              <!-- å…¶é¤˜çµ±è¨ˆå…§å®¹ä¸è®Š -->
            </VBox>

            <VBox spacing="8" VBox.vgrow="ALWAYS" alignment="BOTTOM_CENTER">
              <!-- äº’å‹•æŒ‰éˆ•å€ä¿æŒä¸è®Š -->
            </VBox>
          </VBox>
        </HBox>
      </center>
    </BorderPane>

    <!-- ç–ŠåŠ é¡¯ç¤ºï¼šLoading æŒ‡ç¤ºå™¨ -->
    <ProgressIndicator fx:id="loadingIndicator"
                       visible="false"
                       styleClass="loading-indicator"
                       StackPane.alignment="CENTER"/>

    <!-- ç–ŠåŠ é¡¯ç¤ºï¼šæµ®å‹• + æŒ‰éˆ• -->
    <Button fx:id="plusBtn"
            text="+"
            styleClass="fab"
            onAction="#onFocusInput"
            StackPane.alignment="BOTTOM_RIGHT">
      <StackPane.margin>
        <Insets bottom="30" right="30"/>
      </StackPane.margin>
    </Button>
  </children>
</StackPane>
