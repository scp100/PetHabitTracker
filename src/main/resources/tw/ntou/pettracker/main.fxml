<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.media.MediaView?>

<StackPane xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="tw.ntou.pettracker.MainController"
           styleClass="app-container">
  <children>
    <!-- åŽŸæœ¬çš„ BorderPane ä¸»é«” -->
    <BorderPane styleClass="app-container">

      <!-- é ‚éƒ¨æ¨™é¡Œæ¬„å’Œå°Žèˆª -->
      <top>
        <VBox>
          <HBox styleClass="header-bar" alignment="CENTER_LEFT">
            <padding>
              <Insets top="16" right="24" bottom="16" left="24"/>
            </padding>

            <Label text="ðŸ± Pet Habit Tracker" styleClass="app-title"/>
            <Region HBox.hgrow="ALWAYS"/>

            <HBox styleClass="progress-display" spacing="16" alignment="CENTER">
              <Label text="ä»Šæ—¥:" styleClass="progress-label"/>
              <Label fx:id="dailyProgressLabel" text="0/5" styleClass="progress-value"/>
              <Label text="æœ¬æœˆ:" styleClass="progress-label"/>
              <Label fx:id="monthlyProgressLabel" text="0/30" styleClass="progress-value"/>
            </HBox>

            <Region HBox.hgrow="ALWAYS"/>

            <HBox spacing="8">
              <Label fx:id="streakLabel" text="ðŸ”¥ 0 å¤©" styleClass="streak-label"/>

              <Button fx:id="themeButton" text="ðŸŽ¨" styleClass="icon-button">
                <tooltip><Tooltip text="åˆ‡æ›ä¸»é¡Œ"/></tooltip>
              </Button>
              <Button fx:id="statsButton" text="ðŸ“Š" styleClass="icon-button">
                <tooltip><Tooltip text="çµ±è¨ˆå ±å‘Š"/></tooltip>
              </Button>
              <Button fx:id="achievementButton" text="ðŸ†" styleClass="icon-button">
                <tooltip><Tooltip text="æˆå°±ç³»çµ±"/></tooltip>
              </Button>
              <Button fx:id="settingsBtn" text="âš™ï¸" styleClass="icon-button"  onAction="#onSettingsClicked">
                <tooltip><Tooltip text="è¨­å®š"/></tooltip>
              </Button>
            </HBox>
          </HBox>

          <HBox styleClass="view-tabs" spacing="0">
            <padding>
              <Insets top="0" right="24" bottom="0" left="24"/>
            </padding>
            <ToggleButton fx:id="todayTab" text="ðŸ“… ä»Šæ—¥" styleClass="view-tab" selected="true"/>
            <ToggleButton fx:id="upcomingTab" text="ðŸ“‹ å³å°‡åˆ°ä¾†" styleClass="view-tab"/>
            <ToggleButton fx:id="allTab" text="ðŸ“ å…¨éƒ¨" styleClass="view-tab"/>
          </HBox>
        </VBox>
      </top>

      <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
      <center>
        <HBox spacing="0">

          <!-- ä»»å‹™åˆ—è¡¨å€åŸŸ -->
          <VBox styleClass="main-content" HBox.hgrow="ALWAYS">

            <!-- å¿«é€Ÿæ–°å¢žä»»å‹™æ¬„ -->
            <HBox fx:id="inputBar" styleClass="quick-add-bar" spacing="12" alignment="CENTER_LEFT"
                  visible="true" managed="true">
              <padding>
                <Insets top="16" right="24" bottom="16" left="24"/>
              </padding>

              <TextField fx:id="descField"
                         promptText="å¿«é€Ÿæ–°å¢žä»»å‹™... (ä¾‹: æ˜Žå¤© é‹å‹• 30åˆ†é˜)"
                         styleClass="quick-add-input"
                         onAction="#onAddTask"
                         HBox.hgrow="ALWAYS"/>

              <DatePicker fx:id="datePicker" styleClass="date-picker"/>
              <ComboBox fx:id="prioBox" styleClass="priority-combo" prefWidth="100"/>
              <ComboBox fx:id="categoryFilter" styleClass="category-combo"
                        promptText="é¸æ“‡é¡žåˆ¥" prefWidth="120"/>
              <Button text="æ–°å¢ž" styleClass="add-button"
                      onAction="#onAddTask"/>
            </HBox>

            <!-- æœç´¢å’Œç¯©é¸æ¬„ -->
            <HBox styleClass="search-filter-bar" spacing="12" alignment="CENTER_LEFT">
              <padding>
                <Insets top="12" right="24" bottom="12" left="24"/>
              </padding>

              <TextField fx:id="searchField"
                         promptText="æœç´¢ä»»å‹™..."
                         styleClass="search-input"
                         prefWidth="200"/>

              <ComboBox fx:id="filterPriorityBox"
                        promptText="å„ªå…ˆç´šç¯©é¸"
                        styleClass="filter-combo"
                        prefWidth="120"/>

              <ComboBox fx:id="filterStatusBox"
                        promptText="ç‹€æ…‹ç¯©é¸"
                        styleClass="filter-combo"
                        prefWidth="100"/>

              <Button fx:id="clearFiltersBtn" text="æ¸…é™¤ç¯©é¸"
                      styleClass="clear-filter-btn"
                      onAction="#onClearFilters"/>

              <Region HBox.hgrow="ALWAYS"/>

              <!-- æ‰¹é‡æ“ä½œæŒ‰éˆ• -->
              <Button fx:id="batchCompleteBtn" text="æ‰¹é‡å®Œæˆ"
                      styleClass="batch-btn" visible="false"
                      onAction="#onBatchComplete"/>
              <Button fx:id="batchDeleteBtn" text="æ‰¹é‡åˆªé™¤"
                      styleClass="batch-btn-danger" visible="false"
                      onAction="#onBatchDelete"/>

              <!-- æŽ’åºé¸é … -->
              <Label text="æŽ’åº:" styleClass="sort-label"/>
              <ComboBox fx:id="sortBox"
                        styleClass="sort-combo"
                        prefWidth="150"/>
            </HBox>

            <!-- ä»»å‹™åˆ—è¡¨å®¹å™¨ -->
            <ScrollPane styleClass="task-scroll-pane" fitToWidth="true" VBox.vgrow="ALWAYS">
              <content>
                <TableView fx:id="table" styleClass="task-table" editable="true">
                  <columns>
                    <TableColumn fx:id="doneCol" text="âœ“" prefWidth="50"
                                 resizable="false" styleClass="done-column"/>
                    <TableColumn fx:id="descCol" text="ä»»å‹™æè¿°" prefWidth="280"
                                 styleClass="desc-column"/>
                    <TableColumn fx:id="dateCol" text="åˆ°æœŸæ—¥" prefWidth="100"
                                 styleClass="date-column"/>
                    <TableColumn fx:id="prioCol" text="å„ªå…ˆç´š" prefWidth="80"
                                 styleClass="priority-column"/>
                    <TableColumn fx:id="categoryCol" text="é¡žåˆ¥" prefWidth="100"
                                 styleClass="category-column"/>
                    <TableColumn fx:id="deleteCol" text="æ“ä½œ" prefWidth="120"
                                 resizable="false" styleClass="action-column"/>
                  </columns>
                  <placeholder>
                    <Label text="æš«ç„¡ä»»å‹™ï¼Œé»žæ“Šä¸Šæ–¹è¼¸å…¥æ¡†æ–°å¢žç¬¬ä¸€å€‹ä»»å‹™å§ï¼"
                           styleClass="empty-placeholder"/>
                  </placeholder>
                </TableView>
              </content>
            </ScrollPane>

          </VBox>

          <!-- å¯µç‰©ç‹€æ…‹å´é‚Šæ¬„ -->
          <VBox fx:id="petPanel" styleClass="pet-sidebar" spacing="16">
            <padding>
              <Insets top="24" right="24" bottom="24" left="24"/>
            </padding>

            <!-- å¯µç‰©é ­åƒåŠå½±ç‰‡æ’­æ”¾å€åŸŸ -->
            <VBox styleClass="pet-avatar-section" spacing="12" alignment="CENTER">
              <StackPane prefWidth="120" prefHeight="120">
                <!-- éœæ…‹é è¨­åœ–ç‰‡ -->
                <ImageView fx:id="petImage" fitWidth="120" fitHeight="120"
                           preserveRatio="true" styleClass="pet-avatar"/>
                <!-- å‹•æ…‹å½±ç‰‡é¡¯ç¤º -->
                <MediaView fx:id="petMediaView" fitWidth="120" fitHeight="120"
                           preserveRatio="true" visible="true"/>
              </StackPane>

              <Label text="å°è²“å’ª" styleClass="pet-name"/>
              <Label text="Lv.1" styleClass="pet-level"/>
            </VBox>

            <!-- å½±ç‰‡ç›¸ç°¿æŒ‰éˆ• -->
            <Button fx:id="videoGalleryBtn" text="ðŸ“¹ å½±ç‰‡ç›¸ç°¿"
                    styleClass="gallery-button" maxWidth="Infinity"
                    onAction="#onShowVideoGallery"/>

            <!-- å¯µç‰©ç‹€æ…‹æ¢ -->
            <VBox styleClass="pet-stats" spacing="16">
              <VBox spacing="8">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ’–" styleClass="stat-icon"/>
                  <Label text="æ»¿æ„åº¦" styleClass="stat-label"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="satisfactionLabel" text="80%" styleClass="stat-value"/>
                </HBox>
                <ProgressBar fx:id="satisfactionBar" prefWidth="200"
                             progress="0.8" styleClass="satisfaction-bar"/>
              </VBox>
              <VBox spacing="8">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ–" styleClass="stat-icon"/>
                  <Label text="é£½é£Ÿåº¦" styleClass="stat-label"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="fullnessLabel" text="60%" styleClass="stat-value"/>
                </HBox>
                <ProgressBar fx:id="fullnessBar" prefWidth="200"
                             progress="0.6" styleClass="fullness-bar"/>
              </VBox>
            </VBox>

            <!-- ä»»å‹™çµ±è¨ˆå€åŸŸ -->
            <VBox styleClass="task-stats" spacing="12">
              <Label text="ðŸ“Š ä»»å‹™çµ±è¨ˆ" styleClass="section-title"/>

              <VBox spacing="6">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ“" styleClass="stat-icon-small"/>
                  <Label text="ç¸½ä»»å‹™:" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="totalTasksLabel" text="0" styleClass="stat-value-small"/>
                </HBox>

                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="âœ…" styleClass="stat-icon-small"/>
                  <Label text="å·²å®Œæˆ:" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="completedTasksLabel" text="0" styleClass="stat-value-small"/>
                </HBox>

                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="â³" styleClass="stat-icon-small"/>
                  <Label text="é€²è¡Œä¸­:" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="pendingTasksLabel" text="0" styleClass="stat-value-small"/>
                </HBox>

                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="â°" styleClass="stat-icon-small"/>
                  <Label text="ä»Šæ—¥åˆ°æœŸ:" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="todayTasksLabel" text="0" styleClass="stat-value-small"/>
                </HBox>

                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ“…" styleClass="stat-icon-small"/>
                  <Label text="é€¾æœŸ:" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="overdueTasksLabel" text="0" styleClass="stat-value-small"/>
                </HBox>
              </VBox>

              <!-- å®ŒæˆçŽ‡é€²åº¦æ¢ -->
              <VBox spacing="4">
                <HBox alignment="CENTER_LEFT" spacing="8">
                  <Label text="ðŸ“ˆ å®ŒæˆçŽ‡" styleClass="stat-label-small"/>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Label fx:id="completionRateLabel" text="0%" styleClass="stat-value-small"/>
                </HBox>
                <ProgressBar fx:id="completionRateBar" prefWidth="200" progress="0"
                             styleClass="completion-rate-bar"/>
              </VBox>
            </VBox>

            <!-- å¯µç‰©äº’å‹•æŒ‰éˆ• -->
            <VBox spacing="8" VBox.vgrow="ALWAYS" alignment="BOTTOM_CENTER">
              <Button fx:id="feedPetBtn" text="ðŸŽ é¤µé£Ÿ"
                      styleClass="pet-action-btn" prefWidth="200"/>
              <Button fx:id="playWithPetBtn" text="ðŸŽ¾ çŽ©è€"
                      styleClass="pet-action-btn" prefWidth="200"/>
              <Label fx:id="playChanceLabel" text="å‰©é¤˜çŽ©è€æ¬¡æ•¸ï¼š0"  style="-fx-background-color: white; -fx-padding: 5;"/>
            </VBox>

          </VBox>

        </HBox>
      </center>

    </BorderPane>

    <!-- ç–ŠåŠ é¡¯ç¤ºï¼šLoading æŒ‡ç¤ºå™¨ -->
    <ProgressIndicator fx:id="loadingIndicator"
                       visible="false"
                       styleClass="loading-indicator"
                       StackPane.alignment="CENTER"/>


  </children>
</StackPane>
